<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Response Map — Hydrants + Routing + Follow</title>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">// Open panel on load (half screen / bottom sheet)
showPanel();
</script>
  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <!-- Geocoder (Nominatim) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <!-- Fast spatial index for k-nearest -->
  <script src="https://unpkg.com/kdbush@4.0.2/kdbush.min.js"></script>
  <script src="https://unpkg.com/geokdbush@4.0.0/geokdbush.min.js"></script>
  <style>
    :root{ --bg:#0b1020;--panel:#111831;--ink:#eef3ff;--muted:#b7c2e1;--accent:#4da3ff; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .app{display:grid;grid-template-rows:auto 1fr; height:100%;}
    header{position:sticky;top:0;z-index:1000;display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;padding:.5rem .75rem;border-bottom:1px solid #1b2551;background:linear-gradient(180deg,#0c1430,#0b1020)}
    header .brand{font-weight:800;letter-spacing:.3px}
    header .timer{margin-left:auto;background:#0f1733;border:1px solid #1b2551;border-radius:12px;padding:.3rem .6rem;font-variant-numeric:tabular-nums}
    header .btn{background:#0f1733;border:1px solid #1b2551;color:var(--ink);border-radius:10px;padding:.35rem .6rem;cursor:pointer}
    header .btn.primary{background:var(--accent);border-color:#2c7bd9;color:#051026;font-weight:700}

    .main{display:grid;grid-template-columns:1fr 1fr;height:calc(100vh - 56px)}
    .main.full{grid-template-columns:1fr 0 !important;}
    #map{width:100%;height:100%}

    aside{height:100%;overflow:auto;background:var(--panel);border-left:1px solid #1b2551;transition:transform .25s ease;z-index:600;}
    aside.hidden{display:none !important}
    .pane{padding:.8rem;border-bottom:1px solid #1b2551}
    .pane h3{margin:.2rem 0 .6rem 0;font-size:1rem}
    .small{font-size:.82rem;color:var(--muted)}

    .toggle-panel{position:absolute;right:12px;top:12px;z-index:1000;background:#0f1733;border:1px solid #1b2551;border-radius:12px;padding:.35rem .6rem;cursor:pointer}

    @media (max-width: 900px){
  /* Single column map; panel becomes a bottom-sheet overlay */
  .main{grid-template-columns:1fr;grid-template-rows:1fr}
  #map{height:calc(100vh - 56px)}
  aside{position:fixed;left:0;right:0;bottom:0;top:auto;max-height:55vh;z-index:1001;border-top:1px solid #1b2551;border-left:none;background:var(--panel);transform:translateY(100%);transition:transform .25s ease}
  aside.open{transform:translateY(0)}
  .toggle-panel{right:12px;top:auto;bottom:12px}
}

      aside{position:fixed;inset:auto 0 0 0;width:100%;max-height:50vh;border-left:none;border-top:1px solid #1b2551;transform:translateY(100%)}
      aside.open{transform:translateY(0)}
      #map{height:100%}
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="brand">Response Map</div>
    <button id="panelToggle" class="btn">Panel</button>
    <button id="routeIncidentBtn" class="btn">Route to incident</button>
    <button id="followBtn" class="btn">Follow me</button>
    <button id="timerBtn" class="btn">Start timer</button>
    <div id="timer" class="timer">00:00:00</div>
  </header>

  <div class="main" id="main">
    <div id="map">
      <button id="floatingToggle" class="toggle-panel">Panel</button>
    </div>

    <aside id="side" class="open">
      <div class="pane">
        <h3>Incident</h3>
        <input id="incidentInput" class="input" type="text" placeholder="Type incident location (address, block, POI)" />
        <button id="incidentGo" class="btn primary">Route to incident</button>
      </div>
      <div class="pane">
        <h3>Hydrant search</h3>
        <input id="hydrantSearch" class="input" list="hydrantList" placeholder="Search HYD_ID…" />
        <datalist id="hydrantList"></datalist>
      </div>
    </aside>
  </div>
</div>

<script>
// Adjust panel behavior: show initially, hide after incident/hydrant search
function hidePanel(){
  const side = document.getElementById('side');
  const main = document.getElementById('main');
  if (window.matchMedia('(max-width:900px)').matches){
    side.classList.remove('open');
  } else {
    side.classList.add('hidden');
    main.classList.add('full');
  }
}
function showPanel(){
  const side = document.getElementById('side');
  const main = document.getElementById('main');
  if (window.matchMedia('(max-width:900px)').matches){
    side.classList.add('open');
  } else {
    side.classList.remove('hidden');
    main.classList.remove('full');
  }
}

document.getElementById('panelToggle').addEventListener('click', ()=>{
  const side = document.getElementById('side');
  if (window.matchMedia('(max-width:900px)').matches){
    side.classList.toggle('open');
  } else {
    if(side.classList.contains('hidden')) showPanel(); else hidePanel();
  }
});
// Floating toggle on map for mobile
const ft = document.getElementById('floatingToggle');
if(ft){ ft.addEventListener('click', ()=>{ const s=document.getElementById('side'); s.classList.toggle('open'); }); }
 else hidePanel();
});

document.getElementById('incidentGo').addEventListener('click', ()=>{
  // your existing incident geocode + routing logic goes here...
  hidePanel();
});

document.getElementById('hydrantSearch').addEventListener('change', ()=>{
  // your existing hydrant zoom logic goes here...
  hidePanel();
});
</script>
</body>
</html>
